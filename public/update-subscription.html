<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .plan-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .plan-info h3 {
            margin-top: 0;
            color: #667eea;
        }
        .plan-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸</h1>
        <p class="subtitle">ì‚¬ìš©ìì˜ êµ¬ë… í”Œëœê³¼ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤</p>

        <div class="info">
            <strong>â„¹ï¸ ì•ˆë‚´:</strong> ì´ ë„êµ¬ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì‚¬ìš©ìì˜ êµ¬ë… ìƒíƒœë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. 
            ì‹¤ì œ ê²°ì œ ì—†ì´ ìœ ë£Œ í”Œëœì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>

        <div class="plan-info">
            <h3>ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ í”Œëœ</h3>
            <ul>
                <li><strong>guest</strong>: ê²ŒìŠ¤íŠ¸ (ë¬´ë£Œ, SEO ë¶„ì„ê¹Œì§€ë§Œ)</li>
                <li><strong>basic</strong>: ë² ì´ì§ (â‚©99,000 - ì „ì²´ ë¶„ì„)</li>
                <li><strong>pro</strong>: í”„ë¡œ (â‚©299,000 - ìƒì„¸ ë¶„ì„ + ìš°ì„ ìˆœìœ„)</li>
                <li><strong>enterprise</strong>: ì—”í„°í”„ë¼ì´ì¦ˆ (ë¬¸ì˜ - ë¬´ì œí•œ)</li>
            </ul>
        </div>

        <form id="updateForm">
            <div class="form-group">
                <label for="userEmail">ì‚¬ìš©ì ì´ë©”ì¼</label>
                <input type="email" id="userEmail" placeholder="test6789@example.com" required>
            </div>

            <div class="form-group">
                <label for="subscriptionPlan">êµ¬ë… í”Œëœ</label>
                <select id="subscriptionPlan" required>
                    <option value="">í”Œëœ ì„ íƒ...</option>
                    <option value="guest">Guest (ë¬´ë£Œ)</option>
                    <option value="basic">Basic (â‚©99,000)</option>
                    <option value="pro">Pro (â‚©299,000)</option>
                    <option value="enterprise">Enterprise (ë¬¸ì˜)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="subscriptionStatus">êµ¬ë… ìƒíƒœ</label>
                <select id="subscriptionStatus" required>
                    <option value="">ìƒíƒœ ì„ íƒ...</option>
                    <option value="active">Active (í™œì„±)</option>
                    <option value="inactive">Inactive (ë¹„í™œì„±)</option>
                    <option value="cancelled">Cancelled (ì·¨ì†Œë¨)</option>
                </select>
            </div>

            <button type="submit">êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸</button>
        </form>

        <div id="result" class="result"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://hfwqtcgwdqvxfhwgmwfp.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhmd3F0Y2d3ZHF2eGZod2dtd2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY3NDc0NjAsImV4cCI6MjA1MjMyMzQ2MH0.8wLmGTXJJLUiAOlQpRZNBQJLqQvdqN1-eTGtpwLZQQI';
        const supabase = createClient(supabaseUrl, supabaseKey);

        document.getElementById('updateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const userEmail = document.getElementById('userEmail').value;
            const subscriptionPlan = document.getElementById('subscriptionPlan').value;
            const subscriptionStatus = document.getElementById('subscriptionStatus').value;
            const resultDiv = document.getElementById('result');

            try {
                console.log('ğŸ” ì‚¬ìš©ì ì¡°íšŒ ì¤‘:', userEmail);

                // 1. ì‚¬ìš©ì ì°¾ê¸°
                const { data: users, error: findError } = await supabase
                    .from('users')
                    .select('*')
                    .eq('email', userEmail);

                if (findError) {
                    throw new Error(`ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨: ${findError.message}`);
                }

                if (!users || users.length === 0) {
                    throw new Error(`ì´ë©”ì¼ ${userEmail}ì— í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                const user = users[0];
                console.log('âœ… ì‚¬ìš©ì ì°¾ìŒ:', user);

                // 2. êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸
                console.log('ğŸ“ êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘...');
                const { data: updateData, error: updateError } = await supabase
                    .from('users')
                    .update({
                        subscription_plan: subscriptionPlan,
                        subscription_status: subscriptionStatus,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', user.id)
                    .select();

                if (updateError) {
                    throw new Error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateError.message}`);
                }

                console.log('âœ… ì—…ë°ì´íŠ¸ ì„±ê³µ:', updateData);

                resultDiv.className = 'result success';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <strong>âœ… ì„±ê³µ!</strong><br>
                    ì‚¬ìš©ì: ${userEmail}<br>
                    í”Œëœ: ${subscriptionPlan}<br>
                    ìƒíƒœ: ${subscriptionStatus}<br>
                    <br>
                    <em>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë©ë‹ˆë‹¤.</em>
                `;

            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜:', error);
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<strong>âŒ ì˜¤ë¥˜ ë°œìƒ</strong><br>${error.message}`;
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì´ë©”ì¼ ìë™ ì…ë ¥
        window.addEventListener('load', async () => {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (user && user.email) {
                    document.getElementById('userEmail').value = user.email;
                }
            } catch (error) {
                console.log('ìë™ ì´ë©”ì¼ ì…ë ¥ ì‹¤íŒ¨:', error);
            }
        });
    </script>
</body>
</html>
