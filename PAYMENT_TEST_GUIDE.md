# 나이스페이먼츠 결제 테스트 가이드

## 설정 완료 ✅

### 1. 환경 변수 설정
`.env` 파일에 다음이 추가되었습니다:
```
VITE_NICEPAY_MERCHANT_ID=nicepay00m
```

### 2. 결제 통합 완료
- ✅ 나이스페이먼츠 결제 모듈 (`utils/payment/nicepay.ts`)
- ✅ 결제 버튼 컴포넌트 (`components/PaymentButton.tsx`)
- ✅ 결제 성공 페이지 (`pages/PaymentSuccess.tsx`)
- ✅ 결제 실패 페이지 (`pages/PaymentFail.tsx`)
- ✅ 가격 페이지에 결제 버튼 연동 (`pages/PricingPage.tsx`)

## 테스트 방법

### 개발 모드 테스트 (현재 설정)

1. **개발 서버 실행**
   ```bash
   npm run dev
   ```

2. **가격 페이지 접속**
   - http://localhost:3000/pricing

3. **결제 테스트**
   - 로그인 필요 (로그인하지 않으면 로그인 페이지로 이동)
   - 원하는 플랜의 "지금 시작하기" 버튼 클릭
   - 개발 모드에서는 시뮬레이션 확인 창이 표시됩니다
   - "확인" 클릭 시 결제 성공 페이지로 이동

### 실제 나이스페이먼츠 테스트

실제 나이스페이먼츠 결제창을 테스트하려면:

1. **나이스페이먼츠 가맹점 신청**
   - https://www.nicepay.co.kr/ 접속
   - 테스트 계정 신청 (무료)
   - 테스트용 MID(가맹점 ID) 발급받기

2. **.env 파일 업데이트**
   ```
   VITE_NICEPAY_MERCHANT_ID=발급받은_테스트_MID
   ```

3. **테스트 카드 정보**
   나이스페이먼츠 테스트 환경에서 사용 가능한 카드:
   - 카드번호: 5465-2882-0000-0029
   - 유효기간: 아무거나 (미래 날짜)
   - CVC: 123
   - 비밀번호: 00

## 결제 플랜

| 플랜 | 가격 | 설명 |
|------|------|------|
| 마이크로 스냅 | ₩29,000 | 첫 화면만 빠르게 개선 |
| 스냅 (Entry) | ₩99,000 | 가성비 진단으로 이슈 파악 (POPULAR) |
| CVR 부스터 | ₩299,000 | 바로 테스트 가능한 AB 레디 팩 |

## 결제 흐름

1. 사용자가 가격 페이지에서 플랜 선택
2. "지금 시작하기" 버튼 클릭
3. 로그인 확인 (미로그인 시 로그인 페이지로 이동)
4. 나이스페이먼츠 결제창 팝업
5. 결제 정보 입력 및 결제
6. 결제 성공 시:
   - 사용자 구독 상태 업데이트
   - 결제 기록 저장
   - 성공 페이지 표시
7. 결제 실패 시:
   - 실패 페이지 표시

## 주요 파일

### 결제 모듈
- `utils/payment/nicepay.ts` - 나이스페이먼츠 결제 로직
  - `requestPayment()` - 결제 요청
  - `updateSubscriptionStatus()` - 구독 상태 업데이트

### 컴포넌트
- `components/PaymentButton.tsx` - 결제 버튼
- `pages/PaymentSuccess.tsx` - 결제 성공 페이지
- `pages/PaymentFail.tsx` - 결제 실패 페이지
- `pages/PricingPage.tsx` - 가격 페이지

## 보안 주의사항

⚠️ **중요**: `.env` 파일은 절대 Git에 커밋하지 마세요!
- `.env` 파일은 `.gitignore`에 이미 추가되어 있습니다
- 실제 운영 환경에서는 환경 변수를 서버에서 직접 설정하세요

## 문제 해결

### 팝업이 차단되는 경우
- 브라우저 팝업 차단 해제 필요
- 크롬: 주소창 오른쪽 팝업 차단 아이콘 클릭 → 허용

### 결제창이 열리지 않는 경우
- 브라우저 콘솔에서 에러 확인
- `.env` 파일의 `VITE_NICEPAY_MERCHANT_ID` 확인
- 개발 서버 재시작

### 구독 상태가 업데이트되지 않는 경우
- Supabase 연결 확인
- `users` 테이블에 `subscription_status`, `subscription_plan` 컬럼 존재 확인

## 다음 단계

1. ✅ 나이스페이먼츠 테스트 계정 발급
2. ✅ 실제 결제 테스트
3. ⬜ 운영 환경 배포 전 실제 MID로 변경
4. ⬜ 결제 알림 서버 구현 (NotiURL 처리)
5. ⬜ 결제 내역 관리 페이지 구현
